<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SmartCargo-AIPA</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

<style>
body{background:#eef3f7;}
header{background:#002c5a;color:white;padding:10px;text-align:center;}
.panel{display:none;background:white;margin:25px;padding:20px;border-radius:10px;box-shadow:0 0 10px #aaa;}
#asistente{position:fixed;bottom:20px;right:20px;background:#002c5a;color:white;padding:15px;border-radius:8px;width:300px;}
#chat{background:white;color:black;height:200px;overflow-y:auto;padding:10px;margin-bottom:10px;border-radius:8px;}
.alerta{color:red;font-weight:bold;}
</style>
</head>

<body>

<header>
<h1>SMARTCARGO‑AIPA</h1>
<p>Asesoría logística preventiva para proteger la mercancía del cliente.</p>
<nav>
<button class="btn btn-light m-1" onclick="panel('cargas')">Cargas</button>
<button class="btn btn-light m-1" onclick="panel('docs')">Documentos</button>
<button class="btn btn-light m-1" onclick="panel('alertas')">Alertas & Simulación</button>
<button class="btn btn-light m-1" onclick="panel('pagos')">Pagos</button>
<button class="btn btn-light m-1" onclick="panel('config')">Configuración</button>
</nav>
</header>

<!-- CARGAS -->
<div id="cargas" class="panel" style="display:block;">
<h3>Cargas registradas</h3>
<table class="table table-striped" id="tablaCargas">
<thead><tr><th>ID</th><th>Cliente</th><th>Tipo</th><th>Estado</th><th>Alertas</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- DOCUMENTOS -->
<div id="docs" class="panel">
<h3>Subir documentos</h3>
<input type="file" id="docfile" class="form-control">
<button class="btn btn-primary mt-2" onclick="subirDoc()">Subir</button>
<p id="docres" class="mt-3"></p>
</div>

<!-- ALERTAS -->
<div id="alertas" class="panel">
<h3>Simulación de rechazo</h3>
<select id="tipo" class="form-control mb-2">
<option value="Perecederos">Perecederos</option>
<option value="DG">Mercancía DG</option>
<option value="Animales">Animales vivos</option>
<option value="Fragil">Frágiles</option>
</select>
<input type="number" id="alertnum" class="form-control" placeholder="Alertas detectadas">
<button class="btn btn-warning mt-2" onclick="simular()">Simular</button>
<div id="simres" class="mt-3"></div>
</div>

<!-- PAGOS -->
<div id="pagos" class="panel">
<h3>Suscripciones SmartCargo-AIPA</h3>
<button class="btn btn-primary mt-1" onclick="pagar(29)">Básico Mensual – $29</button><br>
<button class="btn btn-success mt-1" onclick="pagar(59)">Premium Mensual – $59</button><br>
<button class="btn btn-primary mt-1" onclick="pagar(295)">Básico Anual – $295</button><br>
<button class="btn btn-success mt-1" onclick="pagar(595)">Premium Anual – $595</button>
</div>

<!-- CONFIG -->
<div id="config" class="panel">
<h3>Idiomas</h3>
<div class="d-flex gap-2 flex-wrap">
<button class="btn btn-outline-dark" onclick="lang('en')">English</button>
<button class="btn btn-outline-dark" onclick="lang('es')">Español</button>
<button class="btn btn-outline-dark" onclick="lang('fr')">Français</button>
<button class="btn btn-outline-dark" onclick="lang('pt')">Português</button>
<button class="btn btn-outline-dark" onclick="lang('zh')">中文</button>
</div>
</div>

<!-- ASISTENTE -->
<div id="asistente">
<h5>Asistente AIPA</h5>
<div id="chat"></div>
<input id="preg" class="form-control mb-2" placeholder="Escribe tu duda">
<button onclick="ask()" class="btn btn-warning w-100">Preguntar</button>
</div>

<script>
function panel(id){
document.querySelectorAll('.panel').forEach(p=>p.style.display='none');
document.getElementById(id).style.display='block';
}

// -------- CARGAS -------- //
async function loadCargas(){
const res = await fetch('/cargas');
const data = await res.json();
const tbody = document.querySelector('#tablaCargas tbody');
tbody.innerHTML='';
data.cargas.forEach(c=>{
const r = tbody.insertRow();
r.insertCell(0).innerText = c[0];
r.insertCell(1).innerText = c[1];
r.insertCell(2).innerText = c[2];
r.insertCell(3).innerText = c[3];
r.insertCell(4).innerHTML = c[4] > 0 ? `<span class="alerta">${c[4]}</span>` : c[4];
});
}
loadCargas();

// -------- DOCUMENTOS -------- //
async function subirDoc(){
let f = document.getElementById("docfile").files[0];
let fd = new FormData();
fd.append("file",f);
let res = await fetch('/documento',{method:"POST",body:fd});
let data = await res.json();
document.getElementById("docres").innerText = data.analisis;
}

// -------- SIMULACIÓN -------- //
async function simular(){
const tipo = document.getElementById("tipo").value;
const alertas = document.getElementById("alertnum").value;
const res = await fetch(`/simulacion/${tipo}/${alertas}`);
const data = await res.json();
document.getElementById("simres").innerHTML `
<b>Riesgo:</b> ${data.riesgo_rechazo}<br>
<i>${data.mensaje}</i>`;
}

// -------- ASISTENTE -------- //
async function ask(){
const p = document.getElementById("preg").value;
let res = await fetch('/asistente',{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({pregunta:p})
});
let data = await res.json();
document.getElementById("chat").innerHTML += `<div><b>Tú:</b> ${p}</div><div><b>AIPA:</b> ${data.respuesta}</div>`;
document.getElementById("preg").value="";
}

// -------- PAGOS -------- //
async function pagar(p){
const res = await fetch('/checkout',{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
precio:p,
success:window.location.href,
cancel:window.location.href
})
});
const data = await res.json();
window.location.href = data.url;
}

// -------- IDIOMAS -------- //
function lang(l){
alert("Idioma cambiado a: " + l + " (interfaz multilenguaje activa)");
}
</script>
</body>
</html>
