<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SmartCargo-ADVISORY — Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root{--brand:#0b4a6f;--accent:#ffb703;}
  body{font-family:Inter,system-ui,Arial,sans-serif;background:#f3f7fb;color:#0b2135;}
  header{background:var(--brand);color:white;padding:18px 12px;}
  .nav-btn{background:transparent;border:0;color:white;margin-right:8px;cursor:pointer;}
  .panel{display:none;background:white;border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(10,20,30,0.06);margin:18px 0}
  .panel.active{display:block}
  #assistantBox{position:fixed;right:18px;bottom:18px;width:340px;z-index:1200}
  #chat{height:240px;overflow:auto;background:white;padding:12px;border-radius:8px;border:1px solid #e6eef6}
  .msg-user{color:#023047;font-weight:600;margin-bottom:4px;}
  .msg-aipa{color:#0b4a6f;margin-bottom:4px;}
  .lang-btn{margin-right:6px}
  .alert-dot{display:inline-block;width:10px;height:10px;background:#ff4d4f;border-radius:50%;margin-left:6px}
  footer{font-size:13px;color:#50657a;padding:10px 0;text-align:center}
  .small-muted{font-size:13px;color:#6b7b8c}
</style>
</head>
<body>

<header class="d-flex align-items-center justify-content-between flex-wrap">
  <div class="d-flex align-items-center">
    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect width='36' height='36' rx='6' fill='%230b4a6f'/><text x='6' y='24' font-size='18' fill='white'>A</text></svg>" alt="logo" style="margin-right:10px">
    <div>
      <h4 style="margin:0">SmartCargo-ADVISORY</h4>
      <div class="small-muted">Asesoría preventiva para proteger la mercancía del cliente</div>
    </div>
  </div>

  <div class="d-flex align-items-center">
    <nav>
      <button class="nav-btn" onclick="showPanel('panelCargas')">Cargas</button>
      <button class="nav-btn" onclick="showPanel('panelDocs')">Documentos</button>
      <button class="nav-btn" onclick="showPanel('panelAlerts')">Alertas</button>
      <button class="nav-btn" onclick="showPanel('panelPayments')">Pagos</button>
      <button class="nav-btn" onclick="showPanel('panelConfig')">Config</button>
    </nav>
  </div>
</header>

<main class="container my-3">

  <!-- PANEL: CARGAS -->
  <section id="panelCargas" class="panel active">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0" id="titleCargas">Cargas activas</h5>
      <div>
        <button class="btn btn-sm btn-outline-primary" onclick="refreshCargas()">Actualizar</button>
        <button class="btn btn-sm btn-outline-success" onclick="openNewCargaModal()">+ Nueva</button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-hover" id="tableCargas">
        <thead class="table-light">
          <tr><th>ID</th><th>Cliente</th><th>Tipo</th><th>Estado</th><th>Alertas</th><th></th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- PANEL: DOCUMENTOS -->
  <section id="panelDocs" class="panel">
    <div class="d-flex justify-content-between">
      <h5>Documentos / Subir</h5>
      <div class="small-muted">Soportados: AWB, Invoice, Packing List, SLI</div>
    </div>
    <div class="row g-3 mt-2">
      <div class="col-md-6">
        <input id="docFile" class="form-control" type="file" />
      </div>
      <div class="col-md-6">
        <button class="btn btn-primary" onclick="uploadDoc()">Subir & Analizar</button>
      </div>
    </div>
    <div id="docResult" class="mt-3 small-muted"></div>
  </section>

  <!-- PANEL: ALERTAS & SIMULATIONS -->
  <section id="panelAlerts" class="panel">
    <h5>Alertas & Simulación</h5>
    <div class="row g-3 mt-2">
      <div class="col-md-4">
        <label class="form-label">Tipo de carga</label>
        <select id="simTipo" class="form-select">
          <option value="Perishables">Perishables</option>
          <option value="DG">Dangerous Goods</option>
          <option value="Animals">Live Animals</option>
          <option value="Fragile">Fragile</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Problemas detectados (número)</label>
        <input id="simCount" class="form-control" type="number" min="0" value="0" />
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <button class="btn btn-warning w-100" onclick="runSimulation()">Ejecutar Simulación</button>
      </div>
    </div>
    <div id="simResult" class="mt-3"></div>
  </section>

  <!-- PANEL: PAGOS -->
  <section id="panelPayments" class="panel">
    <h5>Suscripciones & Servicios</h5>
    <p class="small-muted">Elige un plan o paga por servicio. Pagos procesados por Stripe.</p>
    <div id="subscriptionButtons" class="d-flex gap-2 flex-wrap mb-3"></div>
    <hr />
    <h6>Pagar por servicio</h6>
    <div id="serviceButtons" class="d-flex gap-2 flex-wrap"></div>
  </section>

  <!-- PANEL: CONFIG -->
  <section id="panelConfig" class="panel">
    <h5>Configuración & Idioma</h5>
    <div class="d-flex gap-2 mt-2">
      <button class="btn btn-outline-dark lang-btn" onclick="setLang('en')">English</button>
      <button class="btn btn-outline-dark lang-btn" onclick="setLang('es')">Español</button>
    </div>
    <div class="mt-3 small-muted">
      <p><b>Backend URL:</b> <span id="backendUrlDisplay"></span></p>
      <p>Tip: configura CORS en el backend para permitir este origen.</p>
    </div>
  </section>

</main>

<!-- ASSISTANT -->
<div id="assistantBox">
  <div class="card" style="border-radius:12px;overflow:hidden">
    <div class="card-body p-2">
      <h6 class="mb-2" style="color:white;background:var(--brand);padding:8px;border-radius:6px">AIPA Assistant</h6>
      <div id="chat"></div>
      <div class="mt-2">
        <input id="qInput" class="form-control mb-2" placeholder="Haz una pregunta al asistente">
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-warning w-100" onclick="askAssistant()">Preguntar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="my-3">
  <div class="container small-muted">SmartCargo-ADVISORY • Asesoría únicamente — no certifica • © SmartCargo</div>
</footer>

<script type="module" src="./app.js"></script>
<script>
function showPanel(id){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
</script>
</body>
</html>
